# 原理部分

## 一、MySQL的基础架构

![MySQL简单架构图](./images/MySQL的简单架构图.png)

从上图可以看出， MySQL 主要由下面几部分构成：

- 连接器： 身份认证和权限相关(登录 MySQL 的时候)。
- 查询缓存： 执行查询语句的时候，会先查询缓存（MySQL 8.0 版本后移除，因为这个功能不太实用）。
- 分析器： 没有命中缓存的话，SQL 语句就会经过分析器，分析器说白了就是要先看你的 SQL 语句要干嘛，再检查你的 SQL 语句语法是否正确。
- 优化器： 按照 MySQL 认为最优的方案去执行。
- 执行器： 执行语句，然后从存储引擎返回数据。 执行语句之前会先判断是否有权限，如果没有权限的话，就会报错。
- 插件式存储引擎 ： 主要负责数据的存储和读取，采用的是插件式架构，支持 InnoDB、MyISAM、Memory 等多种存储引擎。

## 二、MySQL的存储引擎

MySQL 支持多种存储引擎，你可以通过 `show engines` 命令来查看 MySQL 支持的所有存储引擎。

主要的几种存储引擎：memory、CSV存储引擎、MyISAM、InnoDB等

### 默认存储引擎

- MySQL 5.5.5 之前，MyISAM 是 MySQL 的默认存储引擎。
- 5.5.5 版本之后，InnoDB 是 MySQL 的默认存储引擎。

### 查看MySQL版本及存储引擎

```text
//查看你的 MySQL 版本
select version();

//查看 MySQL 当前默认的存储引擎
show variables like '%storage_engine%'

```

## 三、MySQL 存储引擎架构了解吗？

- 插件式架构
  
MySQL 存储引擎采用的是 插件式架构 ，支持多种存储引擎，我们甚至可以为不同的数据库表设置不同的存储引擎以适应不同场景的需要。

- 基于表
  
存储引擎是基于表的，而不是数据库。

## 四、MyISAM 和 InnoDB 有什么区别

- InnoDB 支持行级别的锁粒度，MyISAM 不支持，只支持表级别的锁粒度。
- MyISAM 不提供事务支持。InnoDB 提供事务支持，实现了 SQL 标准定义了四个隔离级别。
- MyISAM 不支持外键，而 InnoDB 支持。
- MyISAM 不支持 MVCC，而 InnoDB 支持。
- 虽然 MyISAM 引擎和 InnoDB 引擎都是使用 B+Tree 作为索引结构，但是两者的实现方式不太一样。InnoDB:聚簇索引.InnoDB 引擎中，其数据文件本身就是索引文件。相比 MyISAM，索引文件和数据文件是分离的，其表数据文件本身就是按 B+Tree 组织的一个索引结构，树的叶节点 data 域保存了完整的数据记录。
- MyISAM 不支持数据库异常崩溃后的安全恢复，而 InnoDB 支持。
- InnoDB 的性能比 MyISAM 更强大。

## 五、简述数据库事务

  数据库事务（Transaction）是由若干个SQL语句构成的一个操作序列，有点类似于Java的synchronized同步。
  
  数据库系统保证在一个事务中的所有SQL要么全部执行成功，要么全部不执行，即数据库事务具有ACID特性：

- Atomicity：原子性
- Consistency：一致性
- Isolation：隔离性
- Durability：持久性

## 六、数据库事务的隔离级别
  
  数据库事务是由数据库系统保证的
  
  数据库事务可以并发执行，而数据库系统从效率考虑，对事务定义了不同的隔离级别。
  
  SQL标准定义了4种隔离级别，分别对应可能出现的数据不一致的情况：
| Isolation Level  | 脏读（Dirty Read）  | 不可重复读（Non Repeatable Read）  | 幻读（Phantom Read）  |
| :--------------: | :----------------: | :-------------------------------: | :------------------: |
| Read Uncommitted |        Yes         |                Yes                |         Yes          |
|  Read Committed  |         -          |                Yes                |         Yes          |
| Repeatable Read  |         -          |                 -                 |         Yes          |
|   Serializable   |         -          |                 -                 |          -           |

