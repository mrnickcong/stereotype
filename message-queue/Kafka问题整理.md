# Kafka问题整理

- [Kafka问题整理](#kafka问题整理)
  - [kafka如何消息的不丢失](#kafka如何消息的不丢失)
  - [kafka如何保证顺序消费](#kafka如何保证顺序消费)
    - [方法1：一个Topic划分一个partition](#方法1一个topic划分一个partition)
    - [方法2：一个Topic划分多个partition](#方法2一个topic划分多个partition)
  - [kafka如何保证数据幂等性](#kafka如何保证数据幂等性)
  - [kafka可以脱离zookeeper单独使用吗](#kafka可以脱离zookeeper单独使用吗)
  - [kafka有几种数据保留的策略](#kafka有几种数据保留的策略)
  - [kafka同时设置了7天和10G清除数据，到第五天的时候消息达到了10G，这个时候kafka将如何处理](#kafka同时设置了7天和10g清除数据到第五天的时候消息达到了10g这个时候kafka将如何处理)
  - [什么情况会导致kafka运行变慢](#什么情况会导致kafka运行变慢)
  - [使用kafka集群需要注意什么](#使用kafka集群需要注意什么)

## kafka如何消息的不丢失

## kafka如何保证顺序消费

Kafka的有序性包括全局有序和局部有序
全局有序

### 方法1：一个Topic划分一个partition

- 全局使用一个生产者
- 全局使用一个分区（可以使用不同分区和Topic实现隔离与扩展）
- 全局使用一个消费者（严格到一个线程去消费）
  
这种方法效率低下

### 方法2：一个Topic划分多个partition

- 采用key Hash的方法。以某个message数据特征（订单ID）作为key，再取Hash，那么订单相同的就会分到同一个分区
- 同一个分区只有一个消费者线程去消费，那么一定是有序的
- 同一个分区有多个线程消费者情况下，加入N个内存queue，相同key的数据存储在同一个queue中，每个消费者消费一个内存队列的数据

## kafka如何保证数据幂等性

## kafka可以脱离zookeeper单独使用吗

kafka不能脱离zookeeper单独使用

因为kafka使用zookeeper管理和协调kafka的节点服务器

## kafka有几种数据保留的策略

kafka有两种数据保存策略：

- 按照过期时间保留
- 按照存储的消息大小保留

## kafka同时设置了7天和10G清除数据，到第五天的时候消息达到了10G，这个时候kafka将如何处理

这个时候 kafka 会执行数据清除工作，时间和大小不论那个满足条件，都会清空数据。

## 什么情况会导致kafka运行变慢

- cpu 性能瓶颈
- 磁盘读写瓶颈
- 网络瓶颈

## 使用kafka集群需要注意什么

集群的数量不是越多越好，最好不要超过 7 个，因为节点越多，消息复制需要的时间就越长，整个群组的吞吐量就越低。

集群数量最好是单数，因为超过一半故障集群就不能用了，设置为单数容错率更高。
