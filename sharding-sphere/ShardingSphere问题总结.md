# ShardingSphere问题总结

- [ShardingSphere问题总结](#shardingsphere问题总结)
  - [数据库架构演变与分库分表介绍](#数据库架构演变与分库分表介绍)
    - [海量数据为什么需要MySQL等OLTP数据库](#海量数据为什么需要mysql等oltp数据库)
      - [大数据存储无法替代](#大数据存储无法替代)
      - [NOSQL数据无法替代](#nosql数据无法替代)
    - [MySQL存储海量数据存在的问题](#mysql存储海量数据存在的问题)
    - [MySQL存储海量数据的架构演进](#mysql存储海量数据的架构演进)
      - [数据库单库存在问题](#数据库单库存在问题)
      - [数据库主从复制、读写分离](#数据库主从复制读写分离)
  - [读写分离](#读写分离)
    - [什么要读写分离](#什么要读写分离)
    - [读写分离的方式](#读写分离的方式)
  - [分库分表](#分库分表)
    - [什么是分库分表](#什么是分库分表)
    - [为什么要分库分表](#为什么要分库分表)
      - [性能上](#性能上)
      - [可用性上](#可用性上)
    - [什么情况下要分库分表](#什么情况下要分库分表)
    - [分库分表的方式](#分库分表的方式)
      - [垂直拆分](#垂直拆分)
        - [垂直分库](#垂直分库)
        - [垂直分表](#垂直分表)
      - [水平拆分](#水平拆分)
        - [水平分库](#水平分库)
        - [水平分表](#水平分表)

## 数据库架构演变与分库分表介绍

### 海量数据为什么需要MySQL等OLTP数据库

#### 大数据存储无法替代

- 大数据存储的适用场景：低价值密度的数据，
- 需要进行数据建模、清洗等
  
#### NOSQL数据无法替代

- NOSQL数据库对**事物支持**不完善

### MySQL存储海量数据存在的问题

- 用户请求量大
- 单库、单表的数据量过大

### MySQL存储海量数据的架构演进

- 早期阶段：数据库单库
- 初期阶段：数据库主从复制、读写分离
- 发展阶段：数据库主从复制、读写分离+缓存
- 后期阶段：分库分表

#### 数据库单库存在问题

- 数据库可用性。宕机后应用无法访问
- 数据库单表操作大量数据会有效率和性能的问题

#### 数据库主从复制、读写分离

- 读写分离：解决了大量查询性能问题，没有解决大量增删改的问题

## 读写分离

### 什么要读写分离

### 读写分离的方式

- 基于代码的
- 基于中间件的

## 分库分表

### 什么是分库分表

简单来说，通过某种特定的条件，将我们存放在同一个数据库中的数据分散存放到多个数据库（主机）上面，以达到分散单台设备负载的效果

### 为什么要分库分表

关键字：提升性能、增加可用性。

#### 性能上

- 数据量过多，查询查询时间变长，效率变慢
- MySQL在插入数据的时候，会对表进行加锁，分为表锁定和行锁定
- 请求数量变多，查询性能降低

#### 可用性上

- 单库部署在数据库宕机风险下导致可用性降低

一般来说 MySQL 数据库单表记录最好控制在 500 万条(这是个经验数字)，超过1000万数据量或者100G考虑分表

### 什么情况下要分库分表

- 单机存储容量达到瓶颈
- 数据库连接数处理能力达到上限

一般情况下：

- 垂直拆分会在数据库的设计阶段完成，
- 后续的性能优化优先选择SQL优化、表字段优化、索引优化、增加缓存等方式
- 如果上述情况仍然存在问题，再考虑分表

### 分库分表的方式

分库分表的方式在生产中通常包括四种：

- 垂直分库
- 垂直分表
- 水平分库
- 水平分表

#### 垂直拆分

垂直拆分包括垂直分库和垂直分表，主要侧重于库和表结构上的拆分

1. 解决了业务层面的耦合、业务清晰
2. 能对不同的业务数据进行分级管理
3. 在高并发场景下，一定程度上可以提高数据库的访问性能
4. 垂直拆分没有解决单表数据量过大的问题

##### 垂直分库

根据不同的业务，划分不同的数据库

##### 垂直分表

将一个大表的数据结构进行拆分，划分不同的表结构，表与表之间通过关联字段进行关联

#### 水平拆分

水平拆分：数据结构都是一样的，侧重于对数据进行分片存储

##### 水平分库

##### 水平分表
