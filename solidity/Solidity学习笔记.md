Solidity学习笔记

# 基础部分

## 简介

### 一、智能合约

​	智能合约在本质上是一个契约

### 二、智能合约的性质

1. 不可变性：（immutable）

### 三、执行机制

1. 节点的一侧是交易(Transaction)，另一侧是EVM
2. Block是顺序生成的(广播、共识、机制)，Transaction也是顺序生成
3. Transaction被确认之后，触发EVM的执行。

### 四、开发环境

开发工具：truffle、hardhat

框架：合约打包、模拟器、测试框架

## 合约的基本构成

### 一、合约的基本组成

| 合约构成单元 | 名词解释                                        | 备注 |
| :----------: | ----------------------------------------------- | ---- |
|   状态变量   | 合约的数据                                      |      |
|     函数     | 合约的行为                                      |      |
|  函数修饰器  | 相当于Java中AOP。多用拦截函数的访问控制、校验等 |      |
|  事件event   | 日志，是一种数据支持化存储                      |      |
|   构造函数   |                                                 |      |



1. #### 状态变量：

   1. 变量声明的一般形式

      ```
      类型 [可见性] 变量名;
      举例：uint public x;
      ```

   2. 变量的可见性

      | 可见性关键字 | 可见范围                                      | 备注                                             |
      | ------------ | --------------------------------------------- | ------------------------------------------------ |
      | public       | 完全可见                                      | 虽然可见，但是只读不能写。需要写，再加方法实现。 |
      | private      | 对本合约可见、其他不可见                      |                                                  |
      | internal     | 对本合约及子合约可见，相当于Java中的protected | **变量默认可见性：internal**                     |

      当变量的可见性为public时，编译器编译是会为其自动生成get的同名方法。

      合约外部：其他合约、链下的钱包地址

2. #### 函数：

   1. 函数的一般形式

      ```
      function 函数名 ([参数])[可见性][交易相关][...]returns (返回值){...}
      
      ```
      
      2. 函数的可见性
      
         ​	
      
         | 可见性关键字 |                        可见范围                         |            备注            |
         | :----------: | :-----------------------------------------------------: | :------------------------: |
         |    public    |             合约外部、本合约、子合约均可见              | **函数默认可见性为public** |
         |   private    |                 本合约可见，其他不可见                  |                            |
         |   internal   | 对继承子合约可见，其他不可见（类似于Java中的protected） |                            |

3. 函数修饰器：

4. 事件event：

5. 构造函数：

6. 账号：外部账号和内部账号

   1. 外部账号：钱包地址。

      非对称密码系统主要有RSA、Ecllipse Curve(椭圆曲线)。

      区块链中用的就是椭圆曲线加密算法。钱包账号就是椭圆曲线的公钥。

      Solidity中address，20个字节160位的数据类型

   2. 合约地址：20个字节160位的数据类型。没有公私钥对，地址指向的就是一个合约。

      内部账号：也就是合约账号。

7. 交易属性

​	交易默认是写操作：全网广播、共识确认。（如果不是写操作，意味着区块链状态没有变化）

​	view：合约状态读操作

​	pure：与合约状态无关的函数。也叫纯函数（）

​		纯函数：跟系统状态无关，只跟输入有关的函数

​		纯函数的作用：解决区块链的授信问题。如果交给链下存在不信任的问题

```
//这就是一个纯函数
function add(uint a,uint b)internal pure returns(uint){
	return a+b;
}
```

