# 分布式系统设计

- [分布式系统设计](#分布式系统设计)
  - [如何拆分微服务](#如何拆分微服务)
  - [微服务拆分策略有哪些](#微服务拆分策略有哪些)
    - [功能维度](#功能维度)
    - [非功能维度](#非功能维度)
  - [怎样设计出高内聚、低耦合的微服务](#怎样设计出高内聚低耦合的微服务)

## 如何拆分微服务

拆分微服务的时候，为了尽量保证微服务的稳定，会有一些基本的准则：

1. 单一服务内部功能高内聚，低耦合。
2. 服务自治、接口隔离原则。尽量消除对其他服务的强依赖，这样可以降低沟通成本，提升服务稳定性。服务通过标准的接口隔离，隐藏内部实现细节。这使得服务可以独立开发、测试、部署、运行，以服务为单位持续交付。
3. 避免环形依赖与双向依赖。尽量不要有服务之间的环形依赖或双向依赖，原因是存在这种情况说明我们的功能边界没有化分清楚或者有通用的功能没有下沉下来。
4. 阶段性合并。随着你对业务领域理解的逐渐深入或者业务本身逻辑发生了比较大的变化，亦或者之前的拆分没有考虑的很清楚，导致拆分后的服务边界变得越来越混乱，这时就要重新梳理领域边界，不断纠正拆分的合理性。
5. 持续演进原则

## 微服务拆分策略有哪些

拆分策略可以按功能和非功能维度进行考虑，

- 功能维度主要是划分清楚业务的边界，
- 非功能维度主要考虑六点包括扩展性、复用性、高性能、高可用、安全性、异构性。

### 功能维度

功能维度主要是划分清楚业务边界，采用的主要设计方法可以利用DDD，DDD的战略涉及会建立领域模型，可以通过领域模型指导微服务的拆分，主要分四步进行：

- 第一步，找出领域实体和值对象等领域对象。
- 第二步，找出聚合根，根据实体、值对象与聚合根的依赖关系，建立聚合。
- 第三步，根据业务及语义边界等因素，定义限界上下文。
- 第四步，每一个限界上下文可以拆分为一个对应的微服务，但也要考虑一些非功能因素。

### 非功能维度

非功能维度主要考虑六点包括

- 扩展性
- 复用性
- 高性能
- 高可用
- 安全性
- 异构性

## 怎样设计出高内聚、低耦合的微服务

高内聚低耦合，是一种从上而下指导微服务设计的方法。

实现高内聚低耦合的工具主要有两种方式

1. 同步的接口调用(Feign)
2. 异步的事件驱动(MQ，ApplicationEventPublisher\@EventListener)


